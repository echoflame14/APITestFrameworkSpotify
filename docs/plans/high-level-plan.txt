# Next.js Smart Music Player - Implementation Guide

## Project Structure
```
app/
  api/
    chat/route.ts          // LLM endpoint
    spotify/
      auth/route.ts        // Auth endpoints
      playback/route.ts    // Playback control
      playlists/route.ts   // Playlist management
  (auth)/
    login/page.tsx         // Login page
    callback/page.tsx      // OAuth callback
  layout.tsx
  page.tsx                 // Landing page
components/
  player/
    WebPlayer.tsx          // Client component
    PlaybackControls.tsx   // Client component
  chat/
    ChatInterface.tsx      // Client component
    MessageList.tsx        // Server component
    MessageInput.tsx       // Client component
lib/
  spotify/                 // Adapted from existing services
    client.ts
    playlist.ts
    track.ts
  llm/
    chat.ts
    prompts.ts
  auth/
    session.ts            // Next-auth configuration
```

## Core Services Required

1. **Authentication Service**
   - Next-auth integration with Spotify
   - Token management
   - Session handling

2. **Web Playback Service**
   - Spotify SDK integration
   - Playback state management
   - Device management

3. **LLM Service**
   - Command interpretation
   - Music recommendations
   - Context awareness

4. **Session Context Service**
   - User preferences tracking
   - Playback history
   - Real-time state management

## Implementation Order

1. **Phase 1: Foundation**
   - Next.js project setup
   - Authentication flow
   - Basic player implementation

2. **Phase 2: Chat Interface**
   - LLM integration
   - Command parsing
   - Basic UI

3. **Phase 3: Music Intelligence**
   - Playlist modifications
   - Recommendations
   - Context tracking

4. **Phase 4: Integration**
   - Component connectivity
   - State management
   - Error handling

## Required Environment Variables
```
SPOTIFY_CLIENT_ID=
SPOTIFY_CLIENT_SECRET=
OPENAI_API_KEY=
NEXTAUTH_SECRET=
NEXTAUTH_URL=
```

## Key Features for MVP
- Web playback integration
- Basic chat interface
- Simple LLM-powered music adjustments
- Real-time playlist modifications

## Dependencies to Add
```json
{
  "dependencies": {
    "next": "^14.0.0",
    "next-auth": "^5.0.0",
    "openai": "^4.0.0",
    "react": "^18.0.0",
    "react-dom": "^18.0.0",
    "@spotify/web-playback-sdk": "^1.0.0"
  }
}
```